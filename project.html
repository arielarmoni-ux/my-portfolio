async function initProject() {
    const params = new URLSearchParams(window.location.search);
    const folder = params.get('folder');
    if (!folder) return;

    try {
        // 1. טעינת רשימת פרויקטים לניווט (חצים)
        const listRes = await fetch(`list.txt?v=${Date.now()}`);
        const folders = (await listRes.text()).split(/\r?\n/).filter(f => f.trim() !== "");
        const idx = folders.indexOf(folder);
        if (idx !== -1) {
            document.getElementById('prev-project').href = `project.html?folder=${folders[(idx - 1 + folders.length) % folders.length]}`;
            document.getElementById('next-project').href = `project.html?folder=${folders[(idx + 1) % folders.length]}`;
        }

        // 2. טעינת info.txt וטיפול בטייטלים
        const infoRes = await fetch(`images/${folder}/info.txt?v=${Date.now()}`);
        if (infoRes.ok) {
            const text = await infoRes.text();
            const lines = text.split('\n');
            const metaDiv = document.getElementById('project-meta');
            const descDiv = document.getElementById('project-desc');
            
            metaDiv.innerHTML = ""; // ניקוי לפני טעינה
            descDiv.innerHTML = "";

            lines.forEach(line => {
                const trimmedLine = line.trim();
                if (trimmedLine.includes(":")) {
                    const [label, ...valueParts] = trimmedLine.split(":");
                    const value = valueParts.join(":").trim();
                    
                    // אם זה השורה של הכותרת/שם הפרויקט, נדאג שהיא תהיה בולטת
                    if (label.toLowerCase().includes("title") || label.includes("שם") || label.includes("Project")) {
                        metaDiv.innerHTML += `
                            <div class="meta-item" style="margin-bottom: 15px;">
                                <span class="value" style="font-size: 24px; font-weight: 600; letter-spacing: 0;">${value}</span>
                            </div>`;
                    } else {
                        metaDiv.innerHTML += `
                            <div class="meta-item">
                                <span class="label">${label.trim()}:</span>
                                <span class="value">${value}</span>
                            </div>`;
                    }
                } else if (trimmedLine !== "") {
                    descDiv.innerHTML += `<p>${trimmedLine}</p>`;
                }
            });
        }

        // 3. טעינת תמונות ושמירה על מיקום קבוע (Order)
        const gallery = document.getElementById('gallery');
        gallery.innerHTML = ""; // ניקוי
        
        // ננסה לטעון עד 20 תמונות בצורה מסודרת
        for (let i = 1; i <= 20; i++) {
            const imgPath = `images/${folder}/${i}.jpg`;
            const img = new Image();
            img.src = imgPath;
            
            img.onload = () => {
                const container = document.createElement('div');
                container.style.order = i; // מבטיח שהתמונה הראשונה תהיה ראשונה בלי קשר לזמן הטעינה
                container.style.width = "100%";
                container.appendChild(img);
                gallery.appendChild(container);
            };
            // אם התמונה לא קיימת, הדפדפן פשוט ידלג עליה
        }
    } catch (e) { console.error("Error loading project data:", e); }
    
    setTimeout(() => { document.getElementById('loader').classList.add('hidden'); }, 800);
}
