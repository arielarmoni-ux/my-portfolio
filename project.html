<script>
    async function initProject() {
        const sideList = document.getElementById('side-project-list');
        const params = new URLSearchParams(window.location.search);
        const folder = params.get('folder'); // מקבל את שם התיקייה מהכתובת

        try {
            // 1. טעינת רשימת הפרויקטים מ-list.txt לבניית תפריט הצד
            const listRes = await fetch('list.txt');
            const listText = await listRes.text();
            const folders = listText.split('\n').filter(f => f.trim() !== "");
            
            for (const f of folders) {
                const folderName = f.trim();
                try {
                    // שואב את הכותרת היפה מתוך ה-info של כל פרויקט ברשימה
                    const res = await fetch(`images/${folderName}/info.txt`);
                    const t = await res.text();
                    const title = t.split('\n')[0].trim();
                    sideList.innerHTML += `<a href="project.html?folder=${folderName}">${title}</a>`;
                } catch(e) {
                    console.warn("Could not load menu item for:", folderName);
                }
            }

            // 2. טעינת תוכן הפרויקט הספציפי שבו אנו נמצאים
            if (folder) {
                const res = await fetch(`images/${folder}/info.txt`);
                if (!res.ok) throw new Error("Info file not found");
                
                const text = await res.text();
                const lines = text.split('\n').filter(l => l.trim() !== "");
                
                // כותרת הפרויקט (שורה 1)
                document.getElementById('project-title').innerText = lines[0];
                document.title = lines[0] + " | Ariel Armoni";

                const metaContainer = document.getElementById('project-meta');
                const descContainer = document.getElementById('project-desc');
                
                // עיבוד שאר השורות (מידע טכני מול תיאור)
                for (let i = 1; i < lines.length; i++) {
                    const line = lines[i].trim();
                    if (line.includes(":")) {
                        const [key, ...valueParts] = line.split(":");
                        const value = valueParts.join(":").trim();
                        metaContainer.innerHTML += `<div class="meta-item"><b>${key.trim()}</b> ${value}</div>`;
                    } else {
                        descContainer.innerText = line;
                    }
                }

                // 3. טעינת תמונות הפרויקט (1.jpg עד 30.jpg)
                const gallery = document.getElementById('gallery');
                for (let i = 1; i <= 30; i++) {
                    const img = new Image();
                    img.src = `images/${folder}/${i}.jpg`;
                    img.onload = () => gallery.appendChild(img);
                    // אם התמונה לא קיימת, הדפדפן פשוט ידלג עליה
                }
            }
        } catch (e) {
            console.error("Initialization failed:", e);
        }
    }

    initProject();
</script>
