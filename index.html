<script>
    async function loadContent() {
        const grid = document.getElementById('portfolio-grid');
        const sideList = document.getElementById('side-project-list');
        
        try {
            // טעינת רשימת התיקיות עם נתיב יחסי מפורש
            const response = await fetch('./list.txt');
            if (!response.ok) throw new Error("Could not find list.txt");
            
            const text = await response.text();
            // פיצול השורות וניקוי רווחים נסתרים (חשוב מאוד!)
            const folders = text.split(/\r?\n/).map(f => f.trim()).filter(f => f !== "");

            console.log("Folders found:", folders); // בדיקה ב-Console

            for (const f of folders) {
                try {
                    // נסיון טעינת ה-info.txt של הפרויקט
                    const infoPath = `./images/${f}/info.txt`;
                    const infoRes = await fetch(infoPath);
                    
                    if (!infoRes.ok) {
                        console.error(`Failed to load: ${infoPath}`);
                        continue;
                    }

                    const infoText = await infoRes.text();
                    const title = infoText.split('\n')[0].trim();
                    const link = `project.html?folder=${f}`;
                    
                    // הוספה לתפריט הצד
                    sideList.innerHTML += `<a href="${link}">${title}</a>`;
                    
                    // הוספה לגריד
                    grid.innerHTML += `
                        <a href="${link}">
                            <div class="project-card">
                                <img src="./images/${f}/cover.jpg" alt="${title}" onerror="this.src='https://via.placeholder.com/600x400?text=${f}'">
                                <div class="project-overlay">
                                    <div class="project-title">${title}</div>
                                </div>
                            </div>
                        </a>`;
                } catch(e) {
                    console.error("Error processing folder:", f, e);
                }
            }
        } catch(e) {
            console.error("Main load error:", e);
            grid.innerHTML = `<p style="grid-column: 1/-1; text-align: center;">Error loading projects. Please check if list.txt exists in the root folder.</p>`;
        }
    }
    loadContent();

    // לוגיקה לתפריט המבורגר
    const btn = document.getElementById('menu-btn');
    btn.onclick = (e) => {
        e.stopPropagation();
        document.body.classList.toggle('nav-open');
        const s = btn.querySelectorAll('span');
        if(document.body.classList.contains('nav-open')) {
            s[0].style.transform = 'rotate(45deg) translate(5px, 5px)';
            s[1].style.opacity = '0';
            s[2].style.transform = 'rotate(-45deg) translate(5px, -5px)';
        } else {
            s[0].style.transform = 'none';
            s[1].style.opacity = '1';
            s[2].style.transform = 'none';
        }
    };
    document.onclick = (e) => {
        if (document.body.classList.contains('nav-open') && !e.target.closest('#side-nav')) {
            document.body.classList.remove('nav-open');
            const s = btn.querySelectorAll('span');
            s[0].style.transform = 'none'; s[1].style.opacity = '1'; s[2].style.transform = 'none';
        }
    };
</script>
