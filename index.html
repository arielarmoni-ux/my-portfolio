<script>
    async function loadContent() {
        const grid = document.getElementById('portfolio-grid');
        const sideList = document.getElementById('side-project-list');
        
        try {
            // טעינת רשימת התיקיות
            const response = await fetch('./list.txt');
            if (!response.ok) throw new Error("list.txt missing");
            
            const text = await response.text();
            const folders = text.split(/\r?\n/).map(f => f.trim()).filter(f => f !== "");

            for (const f of folders) {
                try {
                    // מנסה לטעון את ה-info.txt
                    const infoRes = await fetch(`./images/${f}/info.txt`);
                    
                    // אם התיקייה או הקובץ לא קיימים - מדלג לפרויקט הבא בלי לשבור את הדף
                    if (!infoRes.ok) {
                        console.warn(`Skipping ${f}: info.txt not found`);
                        continue; 
                    }
                    
                    const infoText = await infoRes.text();
                    const title = infoText.split('\n')[0].trim();
                    const link = `project.html?folder=${f}`;
                    
                    sideList.innerHTML += `<a href="${link}">${title}</a>`;
                    grid.innerHTML += `
                        <a href="${link}">
                            <div class="project-card">
                                <img src="./images/${f}/cover.jpg" alt="${title}" onerror="this.src='https://via.placeholder.com/600x450?text=Check+Folder+Name'">
                                <div class="project-overlay">
                                    <div class="project-title">${title}</div>
                                </div>
                            </div>
                        </a>`;
                } catch(e) {
                    // שגיאה בפרויקט ספציפי לא תעצור את כל הלולאה
                    console.error(`Error in folder ${f}:`, e);
                }
            }
        } catch(e) {
            console.error("Critical Error:", e);
            grid.innerHTML = "<p>נראה שיש בעיה בטעינת הקבצים. וודא שקובץ list.txt נמצא בתיקייה הראשית.</p>";
        }
    }
    loadContent();

    // לוגיקה לתפריט המבורגר (חשוב להשאיר)
    const btn = document.getElementById('menu-btn');
    btn.onclick = (e) => {
        e.stopPropagation();
        document.body.classList.toggle('nav-open');
    };
</script>
